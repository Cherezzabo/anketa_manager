var APP = {};
var resultName = "";
var resultHouse = "";

//ИНИЦИАЛИЗАЦИЯ ПРИЛОЖЕНИЯ
APP.init = function () {
    this.load();
    this.listener();
};

/*-----------------------------------------------*/
/* Загрузка слайдеров и прочей лабуды при  загрузке окна
 /*-----------------------------------------------*/

APP.load = function () {

    //ПОЛУЧЕНИЕ МАССИВА ИМЕН

    //Получаем JSON массив имен обращением к json.php
    $.post('/json.php', {NAME: "Y"}, function (data) {
        //Полученный JSON массив преобразуем в объект 
        resultName = $.parseJSON(data);
        //Переменная для хранения сгенерированной html-строки 
        var str = '';
        //При каждом элементе в объекте resultName сделать:
        $.each(resultName, function (i, elem) {
            //Положить в строчку имена из объекта
            //{["name": "ФИО"],...}
            str += '<option data-content="' + resultName[i].name.toLowerCase() +
                   '" id="' + resultName[i].name.toLowerCase() + '">' + resultName[i].name;
        });
        //Вставить полученную строку в тэг <datalist>
        $('#user_names').html(str);
    });

    //ПОЛУЧЕНИЕ МАССИВА ДОМОВ
     
     //Получаем JSON массив домов обращением к json.php
     $.post('/json.php', {HOUSE: "Y"}, function (data) {
        //Полученный JSON массив преобразуем в объект
        resultHouse = $.parseJSON(data);
        //Массив для хранения названий домов
        var houseNames = [];
        //При каждом элементе в объекте resultHouse сделать
        $.each(resultHouse, function(i){
            //Проверить есть ли у дома хотя бы 1-ый вопрос
            //{["name": "Название дома", "questions": "{["1": "Вопрос"]}"],...}
            if (resultHouse[i].questions[1]){
               //Если да, то добавить название дома в массив
               houseNames.push(resultHouse[i].name); 
            }
        });
        //Переменная для хранения сгенерированной html-строки 
        var str = '';
        //При каждом элементе в объекте resultHouse сделать:
        $.each(houseNames, function(i){
            //Положить в строчку название дома из массива
            str += '<option data-content="' + houseNames[i].toLowerCase() + 
                   '" id="' + houseNames[i].toLowerCase() + '">' + houseNames[i];
        });
        //Выводим список всех домов, содержащих хотя бы один вопрос
        $('#building').html(str);
     
     });
};

APP.listener = function () {
    
    $('#user_name_input').bind('input', function() {
        var val = $('#user_name_input').val();
        var opts = $('#user_names');
        for (var i = 0; i < opts.length; i++) {
            if (opts[i].value == val) {
                APP.getJsonDataName(val);
            }
        }
    });
    
    $("#house_input").bind('input', function () {
        var val = $('#house_input').val();
        var opts = $('#building > option');
        for (var i = 0; i < opts.length; i++) {
            if (opts[i].value == val) {
                var str_q = '<h2>Выбрать пожелания</h2>';
                $.each(resultHouse, function(i){
                    if(resultHouse[i].name == val){
                        var givenHouse = resultHouse[i];
                        for (var i in givenHouse.questions) {
                            if (givenHouse.questions[i]){
                                str_q += '<p>'+givenHouse.questions[i]+'</p><p><input type="radio" name="extra'
                                    +i+'" value="yes" id="extra'+i+'_yes"><label for="extra'
                                    +i+'_yes"><span></span>Да</label> <input type="radio" name="extra'
                                    +i+'" value="no" id="extra'+i+'_no"><label for="extra'
                                    +i+'_no"><span></span>Нет</label></p>';     
                            };               
                        };
                        $('#questions_block').html(str_q);
                        $('.input-other').css("display", "block");
                        
                        //Отслеживание кол-ва чекнутых радио-баттонов,
                        //если ровно половина, то активируется кнопка
                        $(':radio').bind('click', function() {
                            var radioCount = $(':radio');
                            var checkedCount = $(':checked');
                            if (radioCount.length / checkedCount.length == 2) {
                                $('button.button').removeAttr("disabled");
                            }
                        });
                    }                    
                });
            };
        };
    });
    
    
    
};





APP.getJsonDataName = function (input) {


    //Получение массива имен
    var result = "";
    $.post('/json.php', {NAME: "Y"}, function (data) {
        result = $.parseJSON(data);
        var str = '';
        $.each(result, function (i, elem) {
            str += '<option  data-content="' 
                    + result[i].name.toLowerCase() + '" id="' + result[i].name.toLowerCase() 
                    + '">' + result[i].name;
        });
        $('#user_names').html(str);
    });






};



//# sourceMappingURL=app.min.js.map
